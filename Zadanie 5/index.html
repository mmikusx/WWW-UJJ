<!DOCTYPE html>
<html lang="en">
<body>

<div>
    <div>
        <h1>Web frameworks</h1>
        <ul id="frameworks-list">

        </ul>
    </div>

    <div>
        <h1>Editors</h1>
        <ul id="editors-list">

        </ul>
    </div>
</div>
</body>
<script>
    function buildList(el_id, data) {
        let l = document.getElementById(el_id);
        for(let elem in data) {
            console.log(elem);
            let item = document.createElement('li');
            item.innerText = `${elem} : ${data[elem]} %`;
            l.appendChild(item);
        }
    }

    function getDataAndDisplay(url, data_key, el_id) {
            let req = new XMLHttpRequest();
            req.open('GET', url, false);
            req.send(null);

            if (req.status === 200) {
                console.log(req.response);
                let fullData = JSON.parse(req.response);
                console.log(fullData['StackOverflow Developer Survey 2021']);
                buildList(el_id, fullData['StackOverflow Developer Survey 2021'][data_key]);
            }
    }

    function getDataAndDisplayAsync(url, data_key, el_id) {
        let req = new XMLHttpRequest();
        req.open('GET', url, true);
        req.send(null);

        req.addEventListener('load', () => {
            if (req.status === 200) {
                console.log(req.response);
                let fullData = JSON.parse(req.response);
                console.log(fullData['StackOverflow Developer Survey 2021']);
                buildList(el_id, fullData['StackOverflow Developer Survey 2021'][data_key]);
            }
        });
    }

    function getDataAndDisplayWithFetch(url, data_key, el_id) {
        let response = fetch(url)

        response.then(
            (result) => {
                if(result.status !== 200) {
                    throw Error("HTTP error!");
                } else {
                    return result;
                }
        }).then(
            (result) => {
                return result.json();
            }
        ).then(
            (data) => {
                buildList(el_id, data['StackOverflow Developer Survey 2021'][data_key]);
            }
        ).catch(
            (e) => {
                console.log(e);
            }
        );
    }

    async function getDataAndDisplayWithAsyncAwait(url, data_key, el_id) {
        let response = await fetch(url);
        let data = await response.json()

        buildList(el_id, data['StackOverflow Developer Survey 2021'][data_key]);
    }

    document.addEventListener('DOMContentLoaded', () => {
        getDataAndDisplayWithAsyncAwait('http://sphinx.if.uj.edu.pl/techwww/slowdata?delay=10', 'editors', 'editors-list');
        getDataAndDisplayWithAsyncAwait('http://sphinx.if.uj.edu.pl/techwww/data', 'Web frameworks', 'frameworks-list');
    })
</script>
</html>